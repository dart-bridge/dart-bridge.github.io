<h1 id="service-providers">Service Providers</h1>
<p class="lead">
Bridge <em>revolves</em> around Service Providers. Each on is loaded when the application
starts, and can use the <a href="#/core/container">IoC Container</a> to inject the functionality
into the system.
</p>

<p>Service Providers must follow a few criteria to be included in the startup process.</p>
<ul>
<li>It must implement the <code>ServiceProvider</code> interface. This interface is empty, but
provides the bootstrapper with a hook to decide if a class should be loaded or not.</li>
<li>It must be <code>imported</code> or <code>exported</code> so that it is included in the runtime.</li>
<li>It must be registered in <code>config/app.yaml</code> by its full path.</li>
</ul>
<h2 id="a-custom-service-provider">A custom Service Provider</h2>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="kwd">library</span><span class="pln"> my_library</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyServiceProvider</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ServiceProvider</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

</span><span class="pun">}</span></code></pre>
<p>The path of this class is <code>my_library.MyServiceProvider</code>. So we register that in
<code>config/app.yaml</code>.</p>
<pre><code class="prettyprint lang-yaml prettyprinted" data-lang="yaml" style=""><span class="kwd">service_providers:
</span><span class="pln">  </span><span class="com"># You will most likely have core providers here</span><span class="pln">
  </span><span class="pun">-</span><span class="pln"> my_library.MyServiceProvider</span></code></pre>
<h3 id="lifecycle">Lifecycle</h3>
<p>Each method of the Service Providers are executed together, asynchronously,
throughout the list. To be able to use other modules within the provider, the
methods have specific responsibilities, which always should be followed.</p>
<h4 id="1-setup-">1. <code>setUp</code></h4>
<p>This method should <em>only</em> be used for interaction with the 
<a href="#/core/container">IoC Container</a> for the <em>component's own classes</em>.</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">ExampleServiceProvider</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ServiceProvider</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  setUp</span><span class="pun">(</span><span class="typ">Container</span><span class="pln"> container</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MyClass</span><span class="pln"> myClass</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    container</span><span class="pun">.</span><span class="pln">singleton</span><span class="pun">(</span><span class="pln">myClass</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>This way, we have the component prepared before other Service Providers to interact
with it.</p>
<h4 id="2-load-">2. <code>load</code></h4>
<p>In this method, we <em>interact</em> with both our own and other services. Because the <code>setUp</code>
method has been run on all providers, we can rest assured that the container is ready
to inject whatever we ask for.</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">load</span><span class="pun">(</span><span class="typ">MyClass</span><span class="pln"> myClass</span><span class="pun">,</span><span class="pln"> bridge_http</span><span class="pun">.</span><span class="typ">Server</span><span class="pln"> server</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  server</span><span class="pun">.</span><span class="pln">addMiddleware</span><span class="pun">(...);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<h4 id="3-run-">3. <code>run</code></h4>
<p>When other services have interacted with our service, we can react to that interaction
in the <code>run</code> method. Usually, this is accomplished by binding a singleton in <code>setUp</code>
and letting other services inject that singleton in <code>load</code>.</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">run</span><span class="pun">(</span><span class="typ">MySingleton</span><span class="pln"> singleton</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  singleton</span><span class="pun">.</span><span class="pln">doSomething</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<h4 id="4-teardown-">4. <code>tearDown</code></h4>
<p>This method will be run when the <code>exit</code> command is run on the command line.</p>
<blockquote>
<p><strong>Note</strong> that this will never be run if <kbd>^C</kbd> is used to
exit the program.</p>
</blockquote>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">tearDown</span><span class="pun">(</span><span class="typ">MyClass</span><span class="pln"> myClass</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  myClass
    </span><span class="pun">..</span><span class="pln">dumpSomeInfo</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">..</span><span class="pln">closeSomeConnection</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>

