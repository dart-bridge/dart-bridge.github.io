<dom-module id="doc-router"><template><doc-page><h1 id="router-small-bridge-http-small-">Router <small>bridge.http</small></h1>
<p class="lead">
The router manages all the entry points to your app through HTTP. The entries are backed up with full dependency
injection, so that you have the power of your entire application available to you instantly.
</p>

<p>The route handler function's return value is cast to a format that can be sent back through HTTP. Let's look at the most
basic example:</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">router</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'Hello, world!'</span><span class="pun">;</span><span class="pln">
</span><span class="pun">});</span></code></pre>
<pre><code class="prettyprint lang-html prettyprinted" data-lang="html" style=""><span class="pln">Hello, world!</span></code></pre>
<p>The method name specifies the HTTP method to listen to. The available ones are:</p>
<ul>
<li>GET/HED – <code>get</code></li>
<li>POST – <code>post</code></li>
<li>PUT – <code>put</code></li>
<li>PATCH – <code>patch</code></li>
<li>UPDATE – <code>update</code></li>
<li>DELETE – <code>delete</code></li>
</ul>
<p>Returned strings will be sent as HTML. More complex structures will be attempted to be cast to JSON:</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">router</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="str">'key'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'value'</span><span class="pun">};</span><span class="pln">
</span><span class="pun">});</span></code></pre>
<pre><code class="prettyprint lang-json prettyprinted" data-lang="json" style=""><span class="pun">{</span><span class="str">"key"</span><span class="pun">:</span><span class="str">"value"</span><span class="pun">}</span></code></pre>
<p>Returning a <code>shelf.Response</code> directly is also valid. This is good if you – for instance – want to return a special
HTTP status code:</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">router</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> shelf</span><span class="pun">.</span><span class="typ">Response</span><span class="pun">(</span><span class="lit">400</span><span class="pun">,</span><span class="pln"> body</span><span class="pun">:</span><span class="pln"> </span><span class="str">'No, sir!'</span><span class="pun">));</span></code></pre>
<h2 id="named-routes">Named routes</h2>
<p>A good practice is not to rely on the specific URI of a route for internal references. Instead, you can name the route:</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">router</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> controller</span><span class="pun">.</span><span class="pln">home</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'home'</span><span class="pun">);</span></code></pre>
<h2 id="dependency-injection">Dependency Injection</h2>
<p>The <a href="#/docs/core/service-container">Service Container</a> resolves the callback, giving you the ability to inject whatever
dependencies you like:</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> greet</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'Hello, $name!'</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">router</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Greeter</span><span class="pln"> greeter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> greeter</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">(</span><span class="str">'friend'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">});</span></code></pre>
<pre><code class="prettyprint lang-html prettyprinted" data-lang="html" style=""><span class="pln">Hello, friend!</span></code></pre>
<p>A few special objects are available for injection:</p>
<ul>
<li>The <code>shelf.Request</code></li>
<li>The data sent with the request, parsed into an <code>Input</code> object</li>
<li>The current session, available as a <code>Session</code> object</li>
</ul>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">router</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'path'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">shelf</span><span class="pun">.</span><span class="typ">Request</span><span class="pln"> request</span><span class="pun">,</span><span class="pln">
                    </span><span class="typ">Input</span><span class="pln"> input</span><span class="pun">,</span><span class="pln">
                    </span><span class="typ">Session</span><span class="pln"> session</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  session</span><span class="pun">[</span><span class="str">'counter'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="str">'key'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> session</span><span class="pun">[</span><span class="str">'counter'</span><span class="pun">]++</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">'request.url'</span><span class="pun">:</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">url</span><span class="pun">,</span><span class="pln">
    </span><span class="str">'input'</span><span class="pun">:</span><span class="pln"> input</span><span class="pun">,</span><span class="pln">
    </span><span class="str">'session'</span><span class="pun">:</span><span class="pln"> session</span><span class="pun">,</span><span class="pln">
  </span><span class="pun">};</span><span class="pln">
</span><span class="pun">});</span></code></pre>
<pre><code class="prettyprint lang-http prettyprinted" data-lang="http" style=""><span class="pln">GET http</span><span class="pun">:</span><span class="com">//localhost:1337/path</span></code></pre>
<pre><code class="prettyprint lang-json prettyprinted" data-lang="json" style=""><span class="pun">{</span><span class="pln">
  </span><span class="str">"request.url"</span><span class="pun">:</span><span class="str">"path"</span><span class="pun">,</span><span class="pln">
  </span><span class="str">"input"</span><span class="pun">:{},</span><span class="pln">
  </span><span class="str">"session"</span><span class="pun">:{</span><span class="pln">
    </span><span class="str">"counter"</span><span class="pun">:</span><span class="lit">1</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<pre><code class="prettyprint lang-http prettyprinted" data-lang="http" style=""><span class="pln">GET http</span><span class="pun">:</span><span class="com">//localhost:1337/path?key=value</span></code></pre>
<pre><code class="prettyprint lang-json prettyprinted" data-lang="json" style=""><span class="pun">{</span><span class="pln">
  </span><span class="str">"request.url"</span><span class="pun">:</span><span class="str">"path?key=value"</span><span class="pun">,</span><span class="pln">
  </span><span class="str">"input"</span><span class="pun">:{</span><span class="pln">
    </span><span class="str">"key"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"value"</span><span class="pln">
  </span><span class="pun">},</span><span class="pln">
  </span><span class="str">"session"</span><span class="pun">:{</span><span class="pln">
    </span><span class="str">"counter"</span><span class="pun">:</span><span class="lit">2</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<h2 id="wildcards">Wildcards</h2>
<p>To receive a wildcard segment in the route, prepend the segment with a colon, and receive the wildcard as a named
argument in the handler. The order doesn't matter, but the named argument must match the name of the wildcard:</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="pln">router</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">
    </span><span class="str">'greet/:lastName/:firstName'</span><span class="pun">,</span><span class="pln">
      </span><span class="pun">(</span><span class="typ">Greeter</span><span class="pln"> greeter</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">})</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'$firstName $lastName'</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> greeter</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">(</span><span class="pln">name</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">});</span></code></pre>
<pre><code class="prettyprint lang-http prettyprinted" data-lang="http" style=""><span class="pln">GET http</span><span class="pun">:</span><span class="com">//localhost:1337/greet/Draper/Don</span></code></pre>
<pre><code class="prettyprint lang-html prettyprinted" data-lang="html" style=""><span class="pln">Hello, Don Draper!</span></code></pre>
<h2 id="modulating-the-return-value">Modulating the return value</h2>
<p>Let's say you have an implementation of an interface that is considered an error, but doesn't throw an exception. We
can specify how that interface is parsed as a route return value, by registering a return value modulator on the
<code>Server</code> singleton in a <a href="#/docs/core/service-providers">Service Provider</a>:</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyHttpServiceProvider</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ServiceProvider</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  load</span><span class="pun">(</span><span class="typ">Server</span><span class="pln"> server</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    server</span><span class="pun">.</span><span class="pln">modulateRouteReturnValue</span><span class="pun">((</span><span class="pln">value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="kwd">is</span><span class="pun">!</span><span class="pln"> </span><span class="typ">MyInterface</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> value</span><span class="pun">;</span><span class="pln"> </span><span class="com">// Send to next modulator without changing anything</span><span class="pln">

      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="kwd">is</span><span class="pln"> </span><span class="typ">InvalidMyInterface</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> shelf</span><span class="pun">.</span><span class="typ">Response</span><span class="pun">.</span><span class="pln">notFound</span><span class="pun">(</span><span class="str">'That resource was not found!'</span><span class="pun">);</span><span class="pln">

      </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'Everything went ok!'</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">});</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<blockquote>
<p><strong>Note:</strong> The modulation will pass its value along to the next modulator, however the order of these modulators
can not be relied upon, and a modulation should only return a primitive value or  <code>shelf.Response</code>.</p>
</blockquote>
<h2 id="catching-exceptions">Catching Exceptions</h2>
<p>To abort a request, the easiest and most native approach is to throw an exception. As a default, this will simply return
a 500 error, with a simple text. However, you can globally catch these exceptions and specify the return value.
The handler is resolved through the <a href="#/docs/core/service-container">Container</a>, injecting the exception in question as
its specified type:</p>
<pre><code class="prettyprint lang-dart prettyprinted" data-lang="dart" style=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyHttpServiceProvider</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ServiceProvider</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  load</span><span class="pun">(</span><span class="typ">Server</span><span class="pln"> server</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    server</span><span class="pun">.</span><span class="pln">handleException</span><span class="pun">(</span><span class="typ">HttpNotFoundException</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Greeter</span><span class="pln"> greeter</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HttpNotFoundException</span><span class="pln"> exception</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> greeting </span><span class="pun">=</span><span class="pln"> greeter</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">(</span><span class="str">'Guest'</span><span class="pun">);</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> shelf</span><span class="pun">.</span><span class="typ">Response</span><span class="pun">.</span><span class="pln">notFound</span><span class="pun">(</span><span class="str">'''
        &lt;h1&gt;$greeting&lt;/h1&gt;
        Oops! This page wasn't found!
      '''</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">});</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>

</doc-page></template><script>Polymer({})</script></dom-module>